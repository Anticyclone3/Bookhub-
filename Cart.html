<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="Cart.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Cart Page -->
    <header>
        <h1>Online Books Resume Store</h1>
        <nav>
            <div class="logo">ðŸ“š BookHub</div>
            <a href="Claude Book.html">Home</a>
            <a href="Books.html">Browse Books</a>
            <a href="Cart.html" class="active">Cart</a>
            <a href="Sign.html" onclick="checkSignIn()">My Account</a>
            <a href="Selling.html">Sell Books</a>
            <a href="Contact.html">Contact</a>
        </nav>
    </header>
    <div id="cart" class="page">
        <h2 style="color: white; margin-bottom: 2rem; text-align: center;">Shopping Cart</h2>
        <div id="cartItems"></div>
        <div class="cart-total" id="cartTotal" style="display: none;">
            <h3>Total: $<span id="totalAmount">0</span></h3>
            <button onclick="checkout()">Checkout</button>
        </div>
    </div>
    <footer>
        <p>&copy; 2023 Online Books Resume Store</p>
    </footer>
    <script src="Java2.js"></script>

   <script>
    // Load managedBooks and cart from localStorage
    let managedBooks = JSON.parse(localStorage.getItem('managedBooks')) || [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let totalBooksPurchased = Number(localStorage.getItem('totalBooksPurchased')) || 0;
    let totalSpent = Number(localStorage.getItem('totalSpent')) || 0;

    function saveCart() {
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    function addToCart(bookId) {
        const book = managedBooks.find(b => b.id === bookId);
        if (book) {
            cart.push(book);
            saveCart();
            updateCart();
            alert(`${book.title} added to cart!`);
        }
    }


    function updateCart() {
        const cartCountElement = document.getElementById('cartCount');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const totalAmountElement = document.getElementById('totalAmount');

        if (cartCountElement) {
            cartCountElement.innerText = cart.length; // Total quantity
        }

        if (!cartItems) return;

        cartItems.innerHTML = '';
        let total = 0;

        cart.forEach((item, index) => {
            total += item.price;
            cartItems.innerHTML += `
                <div class="cart-item">
                    <span>
                        ${item.image ? `<img src="${item.image}" width="50" style="vertical-align:middle; margin-right:10px;">` : ''}
                        ${item.title} - $${item.price}
                    </span>
                    <button onclick="removeFromCart(${index})">Remove</button>
                </div>`;
        });

        if (cart.length > 0) {
            cartTotal.style.display = 'block';
            totalAmountElement.innerText = total.toFixed(2);
        } else {
            cartTotal.style.display = 'none';
        }
    }

  function updateQuantity(bookId, change) {
            const item = cart.find(item => item.id === bookId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(bookId);
                    return;
                }
                saveCart();
                displayCart();
                updateCart();
            }
        }

    function removeFromCart(index) {
        cart.splice(index, 1);
        saveCart();
        updateCart();
    }

    function checkout() {
        if (cart.length === 0) {
            alert('Cart is empty!');
            return;
        }

        totalBooksPurchased += cart.length;
        totalSpent += cart.reduce((sum, item) => sum + item.price, 0);

        localStorage.setItem('totalBooksPurchased', totalBooksPurchased);
        localStorage.setItem('totalSpent', totalSpent);

        alert('Purchase successful! Proceed to Google Pay.');
        window.open('https://pay.google.com', '_blank');

        cart = [];
        saveCart();
        updateCart();
        if (typeof updateAccountStats === 'function') updateAccountStats();
    }

    function checkSignIn() {
        const isSignedIn = localStorage.getItem('isSignedIn');
        if (isSignedIn === 'true') {
            window.location.href = 'Account.html';
        } else {
            alert('Please sign in first.');
        }
    }

    function handleSignUp() {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (!name || !email || !password) {
            alert("Please fill in all fields.");
            return;
        }

        // Save user details in localStorage
        localStorage.setItem('userName', name);
        localStorage.setItem('userEmail', email);
        localStorage.setItem('isSignedIn', 'true');

        alert('Account created successfully!');
        window.location.href = 'Account.html'; // redirect to account page
    }

    // Initial load
    updateCart();
</script>

</body>

</html>
